# 平均通道

通常将彩色图像 3D 数组转换为灰度 2D 数组的直观方法是，对于每个像素，取红、绿、蓝像素值的平均值以获得灰度值。这将每个色带组合成合理的灰色近似值。

```python
import numpy as np
from PIL import Image
img = np.asarray(Image.open(img_filename)) / 255
img = np.mean(img, axis=2)
```
![[Pasted image 20230708214557.png]]

# 基于人眼亮度感知的灰度转换

在我们看来，绿色看起来比蓝色亮十倍。通过多次重复精心设计的实验，心理学家已经弄清楚我们对红色、绿色和蓝色的亮度的感知有多么不同。他们为我们提供了一组不同的权重，用于通道平均以获得总亮度。
$$ Y_{linear} = 0.2126R_{linear} + 0.7152G_{linear} + 0.0722B_{linear} $$
![[Pasted image 20230708220533.png]]

# 伽马压缩

当亮度较低时，我们能够看到细微的差异，但在高亮度水平下，我们对它们的敏感度要低得多。为了避免浪费精力来表示高亮度下难以察觉的差异，色标会变形，以便将更多值集中在范围的低端，并在高端将它们分散得更广泛。这称为伽马压缩。因此我们在计算灰度亮度之前要消除伽马压缩的影响，有必要应用逆运算，即伽马拓展：
$$ C_{linear} = \begin{cases}
\frac{C_{srgb}}{12.92},\quad C_{srgb} \leq 0.04045 \\
\left(\frac{C_{srgb} + 0.055}{1.055}\right)^{2.4}, \quad C_{srgb} \gt 0.04045
\end{cases}
$$
![[Pasted image 20230708221345.png]]

# 线性近似

与我们之前使用的加权平均值相比，伽玛解压和重新压缩会产生相当大的计算成本。有时速度比尽可能准确的亮度计算更可取。对于这样的情况，有一个线性近似，这可以让您获得更接近伽马压缩校正版本的结果，但无需额外的计算时间。
$$ Y = 0.299R + 0.587G + 0.114B $$
![[Pasted image 20230708221528.png]]